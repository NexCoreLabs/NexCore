<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYZB5L2R8W"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-PYZB5L2R8W');
        </script>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Sign up your team with NexCore Labs. Get professional digital solutions for your student-led projects.">
        <meta name="author" content="NexCore Labs">
        <meta name="keywords" content="NexCore Labs, signup, page development, project solutions, student projects, digital services, Sultan Qaboos University, Oman, technology, innovation">
        <meta name="theme-color" content="#0a0b1c">
        <meta name="mobile-web-app-capable" content="yes">

        <meta property="og:url" content="https://nexcorelabs.vercel.app/signup.html">
        <meta property="og:type" content="website">
        <meta property="og:title" content="NexCore Labs Pricing - Affordable Digital Solutions">
        <meta property="og:description" content="Transparent pricing for professional page development. Choose the plan that fits your student project.">

        <meta name="twitter:card" content="summary_large_image">
        <meta property="twitter:domain" content="nexcorelabs.vercel.app">
        <meta property="twitter:url" content="https://nexcorelabs.vercel.app/signup.html">
        <meta name="twitter:title" content="NexCore Labs | Sign Up">
        <meta name="twitter:description" content="Sign up your team with NexCore Labs. Get professional digital solutions for your student-led projects.">

        <title>NexCore Labs | Sign Up</title>

        <link rel="icon" href="assets/images/nexcore-icon.png" type="image/png">
        <link rel="stylesheet" href="assets/css/unminified-css.css">
        <link rel="manifest" href="manifest.json">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
        <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    </head>
    <body>
        <div class="background">
            <img class="logo-img" id="logoImg" src="assets/images/nexcore-logo.webp" alt="NexCore Labs Logo">
            <div id="spotLight" class="spot-light"></div>
        </div>

        <header class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <h1 id="logo">NexCore <span>Labs</span></h1>
                </div>

                <div class="dropdown">
                    <div class="core-menu" id="coreMenu" aria-label="Open menu" title="Menu">
                        <span class="dot" aria-hidden="true"></span>
                        <span class="dot" aria-hidden="true"></span>
                        <span class="dot" aria-hidden="true"></span>
                        <span class="dot" aria-hidden="true"></span>
                        <span class="dot" aria-hidden="true"></span>
                        <span class="dot" aria-hidden="true"></span>
                    </div>
                    
                    <div id="myDropdown" class="dropdown-content">
                        <a href="hub.html" class="magic-signup fade" title="Back to Hub">Back to Hub</a>
                        <input type="search" placeholder="What?..." id="myInput" onkeyup="filterFunction()" title="Search...">
                        <a href="hub.html" class="fade" title="NexCore Hub">Hub</a>
                        <a href="hub.html#projects" class="fade" title="Projects">Projects</a>
                        <div class="div-menu-line"></div>
                        <a href="how-to-use.html" class="fade" title="How to Use NexCore" style="margin-top: 0;">How to Use</a>
                        <a href="pricing.html" class="fade" title="Pricing Plans">Pricing</a>
                        <div class="div-menu-line"></div>
                        <a href="index.html#tools" title="Tools & Systems" style="margin-top: 0;">Tools & Systems</a>
                        <a href="index.html#about" title="About NexCore Labs">About Us</a>
                        <a href="index.html#team" title="NexCore Team">Our Team</a>
                        <a href="index.html#contact" title="Contact NexCore">Contact Us</a>
                        <div class="div-menu-line"></div>
                        <a href="faq.html" class="fade" title="FAQ & Support" style="margin-top: 0;">FAQ</a>
                        <a href="terms.html" class="fade" title="Terms of Service">Terms</a>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <section class="panel" style="padding: 3rem 0;">
                <div class="container">
                    <div class="signup-wrapper">
                        <!-- Left Column: Information -->
                        <div class="signup-info">
                            <div class="info-block">
                                <h3><i class="fa-solid fa-rocket"></i> Why Join NexCore?</h3>
                                <p>Align your project vision with our expertise and bring your ideas to life online. We provide comprehensive digital solutions tailored for student-led initiatives.</p>
                                <ul>
                                    <li>Professional page development</li>
                                    <li>Technical support & guidance</li>
                                    <li>Portfolio building opportunity</li>
                                </ul>
                            </div>

                            <div class="info-block">
                                <h3><i class="fa-solid fa-circle-check"></i> What We Require</h3>
                                <p>To ensure the best collaboration, please have the following ready:</p>
                                <ul>
                                    <li>Clear project concept & goals</li>
                                    <li>Team leadership details</li>
                                    <li>University affiliation (SQU)</li>
                                    <li>Contact information</li>
                                </ul>
                            </div>

                            <div class="info-block">
                                <h3><i class="fa-solid fa-handshake"></i> Terms & Conditions</h3>
                                <p>By signing up, you agree to our terms of service and understand our partnership model. Review our full terms to learn about project timelines, deliverables, and intellectual property rights.</p>
                                <p style="margin-top: 1rem;">
                                    <a href="terms.html" target="_blank">Read Full Terms â†’ </a>
                                </p>
                            </div>

                            <div class="info-block">
                                <h3><i class="fa-solid fa-tag"></i> Pricing</h3>
                                <p>Flexible packages designed for student projects. Our pricing adapts to your project scope and requirements.</p>
                                <p style="margin-top: 1rem;">
                                    <a href="pricing.html" target="_blank">View Pricing Plans â†’ </a>
                                </p>
                            </div>

                            <div class="info-block">
                                <h3><i class="fa-solid fa-circle-question"></i> Questions?</h3>
                                <p>Check out our FAQ section for common questions or reach out to our team directly.</p>
                                <p style="margin-top: 1rem;">
                                    <a href="faq.html" target="_blank">Visit FAQ â†’ </a>
                                </p>
                            </div>
                        </div>

                        <!-- Right Column: Signup Form -->
                        <div class="signup-form-wrapper">
                            <div class="form-container">
                                <h2>Align with the Core</h2>
                                <p class="form-subtitle">Connect your vision with the Core â€” where ideas evolve into impact.</p>

                                <form id="signupForm" class="signup-form">
                                    <label class="field">
                                        <input name="projectName" placeholder="Project Name" required>
                                    </label>

                                    <label class="field">
                                        <input name="leaderName" placeholder="Leader Full-Name" required>
                                    </label>

                                    <label class="field">
                                        <input name="leaderEmail" type="email" placeholder="Leader Email (e.g.@squ.edu.om)" required>
                                    </label>

                                    <label class="field">
                                        <textarea name="idea" rows="4" placeholder="Project Idea" required></textarea>
                                    </label>

                                    <div class="div-menu-line"></div>

                                    <div class="field plan-options" role="radiogroup" aria-label="Plan Type">
                                        <!-- <p class="small-label">Plan Type:</p> -->
                                        <div class="plan-grid">
                                            <label class="plan-option" tabindex="0">
                                                <input type="radio" name="planType" value="Starter" data-price="0.3" required>
                                                <div class="option-inner">
                                                    <i class="fa-solid fa-rocket"></i>
                                                    <span class="option-title">Starter <span class="option-price">0.3 OMR + 0.5 OMR (setup fee)</span></span>
                                                    <span class="option-desc">Special card on the Hub Â· 1-week support</span>
                                                </div>
                                            </label>
                                            <label class="plan-option" tabindex="0">
                                                <input type="radio" name="planType" value="Professional" data-price="3.9" required>
                                                <div class="option-inner">
                                                    <i class="fa-solid fa-building"></i>
                                                    <span class="option-title">Professional <span class="option-price">3.9 OMR</span></span>
                                                    <span class="option-desc">Independent page Â· 1-month support Â· setup waived</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div> 

                                    <div class="div-menu-line"></div>

                                    <label class="field checkbox-field">
                                        <input type="checkbox" name="websiteConfirmation" class="checkbox" id="websiteShow" onchange="showWebsiteLabel()">
                                        <p>Have a website?</p>
                                    </label>

                                    <label class="field checkbox-field" id="websiteURLLabel" style="display: none;">
                                        <input name="websiteURL" placeholder="https://www.example.com/">
                                    </label>
                                    
                                    <label class="field checkbox-field">
                                        <input type="checkbox" name="leader" class="checkbox" required>
                                        <p>I'm the leader of the team*</p>
                                    </label>

                                    <label class="field checkbox-field">
                                        <input type="checkbox" name="squAffiliated" class="checkbox" required>
                                        <p>Affiliated with Sultan Qaboos University*</p>
                                    </label>

                                    <label class="field checkbox-field">
                                        <input type="checkbox" name="termsConfirmation" class="checkbox" required>
                                        <p>I agree to the <a href="terms.html" style="text-decoration: underline;" target="_blank">Terms of Service</a>*</p>
                                    </label>

                                    <div class="form-actions">
                                        <button type="submit" class="btn primary">Submit</button>
                                        <button type="reset" id="resetBtn" class="btn ghost">Reset</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="nexcore-sign">
                <img id="nexcoreSign" src="assets/images/nexcore-word.webp" alt="NexCore Labs">
            </div>
        </main>

        <footer class="site-footer">
            <div class="container footer-inner">
                <div class="f-left">
                    <a class="paypal" href="https://www.paypal.me/alfarismujahid" target="_blank" rel="noopener"><i class="fa-solid fa-heart" style="color: #6EE7F3;"></i> Support us on PayPal</a>
                    <br>
                    <small title="All Rights Reserved">NexCore Labs Â© <span id="year"></span> <span id="splitter">|</span>
                        <a href="https://github.com/NexCoreLabs/NexCore/blob/main/LICENSE" target="_blank" class="license-link">
                            <i class="fa-solid fa-scale-balanced"></i> MIT License
                        </a>
                    </small>
                </div>
                <div class="f-right"><small>Empowering our env. to do more</small></div>
            </div>
        </footer>

        <script src="assets/js/script.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="version.js"></script>

        <script>
            console.log(`NexCore Labs version ${APP_VERSION}`);

            function showWebsiteLabel() {
                const checkbox = document.getElementById('websiteShow');
                const label = document.getElementById('websiteURLLabel');
                if (checkbox.checked) {
                    label.style.display = 'block';
                    label.required = true;
                } else {
                    label.style.display = 'none';
                    label.required = false;
                }
            }

            function initPlanOptions() {
                const options = document.querySelectorAll('.plan-option');
                options.forEach(opt => {
                    const input = opt.querySelector('input[type="radio"]');
                    const select = () => {
                        options.forEach(o => o.classList.remove('selected'));
                        if (input.checked) opt.classList.add('selected');
                    };
                    input.addEventListener('change', select);
                    opt.addEventListener('click', () => {
                        input.checked = true;
                        input.dispatchEvent(new Event('change', { bubbles: true }));
                    });
                    opt.addEventListener('keydown', (e) => {
                        if (e.key === ' ' || e.key === 'Enter') {
                            e.preventDefault();
                            input.checked = true;
                            input.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    });
                    // initialize state
                    if (input.checked) opt.classList.add('selected');
                });
            }

            // initialize plan options after DOM content loaded
            document.addEventListener('DOMContentLoaded', initPlanOptions);

            function showStatus(success, message) {
                if (success) {
                    Swal.fire({
                        title: 'âœ… Submitted Successfully!',
                        text: message || 'Your request has been submitted to NexCore Labs. We will contact you soon via email.',
                        background: 'transparent',
                        color: '#eaf6fb',
                        confirmButtonText: 'Awesome ðŸš€',
                        customClass: {
                            popup: 'form-message-popup',
                            confirmButton: 'form-message-btn'
                        },
                        backdrop: `
                            rgba(0, 0, 0, 0.6)
                            url("https://cdn.dribbble.com/users/730703/screenshots/6581243/space.gif")
                            center top
                            no-repeat
                        `,
                    })
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Submission Failed',
                        text: message || 'Please try again later or check your connection.',
                        background: 'transparent',
                        color: '#eaf6fb',
                        confirmButtonText: 'Got it',
                        customClass: {
                            popup: 'form-message-popup',
                            confirmButton: 'form-message-btn'
                        }
                    })
                }
            }
        </script>

        <script type="module">
            // Dynamic import of Supabase so page and event listeners work even if module load fails.
            const supabaseUrl = 'https://qacupmuqeuqspfhwosfu.supabase.co'
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhY3VwbXVxZXVxc3BmaHdvc2Z1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4ODc0MDksImV4cCI6MjA3NjQ2MzQwOX0.wg3Csls252_yP4P0-CgYrop0W1DqtlyNO2XpbdZ5Zzk'

            let supabase = null
            async function ensureSupabase() {
                if (supabase) return supabase
                try {
                    const mod = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm')
                    const createClient = mod.createClient || (mod.default && mod.default.createClient)
                    if (!createClient) throw new Error('Supabase createClient not found in module')
                    supabase = createClient(supabaseUrl, supabaseKey)
                    console.info('Supabase client initialized')
                    return supabase
                } catch (err) {
                    console.error('Failed to load Supabase module:', err)
                    // showStatus may not yet be available if scripts failed earlier; guard it
                    try { showStatus(false, 'Unable to reach backend (Supabase). Please try again later or check your connection.') } catch(e){}
                    throw err
                }
            }

            // Helper to test network reachability to Supabase (lightweight)
            async function testSupabaseReachable() {
                try {
                    const res = await fetch(supabaseUrl, { method: 'HEAD', mode: 'no-cors' })
                    console.info('Supabase reachable (HEAD)')
                    return true
                } catch (err) {
                    console.warn('Supabase reachability check failed:', err)
                    return false
                }
            }

            const signupForm = document.getElementById('signupForm')
            if (!signupForm) console.error('signupForm element not found')

            // Attach submit handler immediately so page responds even if module import fails
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault()

                // Use built-in validity checks (shows browser UI if invalid)
                if (!signupForm.reportValidity()) return;

                const submitBtn = signupForm.querySelector('button[type="submit"]');
                const originalText = submitBtn ? submitBtn.textContent : 'Submit';
                if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Submitting...' }

                const formData = new FormData(signupForm)

                const projectName = formData.get('projectName')
                const leaderName = formData.get('leaderName')
                const leaderEmail = formData.get('leaderEmail')
                const idea = formData.get('idea')
                const websiteConfirmation = document.querySelector('input[name="websiteConfirmation"]').checked;
                const websiteURL = formData.get('websiteURL') || null;

                // Plan info (only sending plan type to Supabase)
                const planType = formData.get('planType') || null;
                if (!planType) {
                    showStatus(false, 'Please select a plan type.')
                    if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = originalText }
                    return;
                }

                try {
                    // ensure supabase client is available
                    await ensureSupabase()

                    console.info('Attempting Supabase insert for plan:', planType)
                    const { data, error } = await supabase
                        .from('teams_sign_up_form')
                        .insert([
                            { project_name: projectName, leader_name: leaderName, leader_email: leaderEmail, idea, website_confirmation: websiteConfirmation, website_url: websiteURL, plan_type: planType }
                        ])

                    if (error) {
                        console.error('Supabase insert error:', error)
                        // Add helpful guidance for common cases
                        if (error.status === 401 || error.status === 403) {
                            showStatus(false, 'Authentication or permission error (check anon key / RLS).')
                        } else if (error.code || error.message) {
                            showStatus(false, error.message || JSON.stringify(error))
                        } else {
                            showStatus(false, 'Unknown error from Supabase. Check console for details.')
                        }
                    } else {
                        console.info('Submission success:', data)
                        showStatus(true, `Selected plan: ${planType}`)
                        signupForm.reset()
                        // reinitialize plan selection visual state
                        initPlanOptions()
                    }
                } catch (err) {
                    console.error('Submission exception:', err)
                    // If module import failed, attempt a basic reachability test to provide guidance
                    const reachable = await testSupabaseReachable()
                    if (!reachable) {
                        showStatus(false, 'Network or CORS issue reaching Supabase. Please check your connection or CORS settings.')
                    } else {
                        showStatus(false, err.message || String(err))
                    }
                } finally {
                    if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = originalText }
                }
            })

            // Extra diagnostics: confirm handler attached
            console.info('Signup submit handler attached')
        </script>
    </body>
</html>
