<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Cookie consent stylesheet (GA will only be injected after consent) -->
        <link rel="stylesheet" href="assets/css/cookie-consent.css">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="NexCore Labs dashboard for teams to manage projects, and resources.">
        <meta name="author" content="NexCore Labs">
        <meta name="keywords" content="NexCore Labs, dashboard, team, projects, student projects, Sultan Qaboos University, Oman">
        <meta name="theme-color" content="#0a0b1c">
        <meta name="mobile-web-app-capable" content="yes">

        <meta property="og:url" content="https://nexcorelabs.vercel.app/dashboard.html">
        <meta property="og:type" content="website">
        <meta property="og:title" content="NexCore Labs | Dashboard">
        <meta property="og:description" content="Team dashboard for managing NexCore Labs projects.">

        <meta name="twitter:card" content="summary_large_image">
        <meta property="twitter:domain" content="nexcorelabs.vercel.app">
        <meta property="twitter:url" content="https://nexcorelabs.vercel.app/dashboard.html">
        <meta name="twitter:title" content="NexCore Labs | Dashboard">
        <meta name="twitter:description" content="Team dashboard for managing NexCore Labs projects.">

        <title>NexCore Labs | Dashboard</title>

        <link rel="icon" href="assets/images/nexcore-icon.png" type="image/png">
        <link rel="stylesheet" href="assets/css/unminified-css.css">
        <link rel="manifest" href="manifest.json">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
        <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-solid-rounded/css/uicons-solid-rounded.css'>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .wrap{max-width:980px;margin:60px auto;padding:16px}
    .box{border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;margin:14px 0;background:rgba(10,11,28,.35)}
    label{display:block;margin:10px 0 6px;opacity:.9}
    input,textarea{
      width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);color:#fff
    }
    textarea{min-height:110px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:#fff;cursor:pointer}
    .btnPrimary{background:rgba(110,231,243,.18);border-color:rgba(110,231,243,.35)}
    .muted{opacity:.75}
    .danger{border-color:rgba(255,120,120,.4);background:rgba(255,120,120,.12)}
    a{color:#6ee7f3}
  </style>
</head>
<body>

  <div class="wrap">
    <h1>Dashboard</h1>
    <p class="muted" id="userLine">Loading…</p>

    <div class="box">
      <div class="row" style="justify-content:space-between">
        <h2 style="margin:0">My Project</h2>
        <div class="row">
          <button class="btn" id="logoutBtn">Logout</button>
        </div>
      </div>

      <!-- State: no project -->
      <div id="noProject" style="display:none;margin-top:12px;">
        <p>You don’t have a project yet.</p>
        <div class="row">
          <input id="newProjectName" placeholder="Project name (e.g., Sovlex)" />
          <button class="btn btnPrimary" id="createProjectBtn">Create Project</button>
        </div>
        <p class="muted" style="margin-top:10px;">
          A draft card/profile will be created. You can edit and publish when ready.
        </p>
      </div>

      <!-- State: has project -->
      <div id="hasProject" style="display:none;margin-top:12px;">
        <p class="muted">
          Public ID: <b id="publicId"></b> • Status: <b id="statusText"></b>
        </p>
        <p class="muted">
          Public link:
          <a id="publicLink" href="#" target="_blank" rel="noopener">open</a>
        </p>

        <label>Project name</label>
        <input id="name" />

        <label>Slug (used in link)</label>
        <input id="slug" placeholder="sovlex" />

        <label>Image URL (optional)</label>
        <input id="image_url" placeholder="https://..." />
        <div style="margin-top:10px;">
          <img id="imgPreview" alt="" style="max-width:240px;border-radius:14px;display:none;border:1px solid rgba(255,255,255,.10);" />
        </div>

        <label>Description</label>
        <textarea id="description"></textarea>

        <div class="row" style="margin-top:12px;">
          <button class="btn btnPrimary" id="saveBtn">Save</button>
          <button class="btn" id="togglePublishBtn">Publish</button>
          <button class="btn danger" id="deleteBtn" style="margin-left:auto;">Delete Project</button>
        </div>

        <p class="muted" id="msg" style="margin-top:10px;"></p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/js/supabase-client.js"></script>

  <script>
const sb = window.supabaseClient;

function isSQU(email) {
  const e = (email || "").toLowerCase().trim();
  return e.endsWith("@squ.edu.om") || e.endsWith("@student.squ.edu.om");
}

const form = document.getElementById("loginForm");
const emailInput = document.getElementById("email");
const btn = form.querySelector('button[type="submit"]');

let cooldownTimer = null;
let cooldownSeconds = 0;

function startCooldown(seconds) {
  cooldownSeconds = seconds;
  btn.disabled = true;
  btn.textContent = `Resend in ${cooldownSeconds}s`;

  cooldownTimer = setInterval(() => {
    cooldownSeconds -= 1;
    if (cooldownSeconds <= 0) {
      clearInterval(cooldownTimer);
      cooldownTimer = null;
      btn.disabled = false;
      btn.textContent = "Send magic link";
      return;
    }
    btn.textContent = `Resend in ${cooldownSeconds}s`;
  }, 1000);
}

form.addEventListener("submit", async (ev) => {
  ev.preventDefault();

  if (btn.disabled) return;

  const email = emailInput.value.trim();

  if (!email) return alert("Please enter your SQU email.");
  if (!isSQU(email)) return alert("Please use your SQU email: @squ.edu.om or @student.squ.edu.om");

  btn.disabled = true;
  btn.textContent = "Sending…";

  const { error } = await sb.auth.signInWithOtp({
    email,
    options: { emailRedirectTo: `${window.location.origin}/dashboard.html` }
  });

  if (error) {
    alert(error.message);
    btn.disabled = false;
    btn.textContent = "Send magic link";
    return;
  }

  alert("Check your email!");
  startCooldown(60);
});

  </script>
        <script src="assets/js/cookie-consent.js" defer></script>
</body>
</html>